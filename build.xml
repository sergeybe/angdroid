<?xml version="1.0" encoding="UTF-8"?>
<project name="Angband" default="angband-debug">

    <!-- Please don't edit this file. Edit build.properties instead of -->

    <!--
    <property environment="env"/>

    <property name="ndk-location" value="${env.ANDROID_NDK_ROOT}" />
    <property name="sdk-location" value="${env.ANDROID_HOME}" />
    -->
    <property file="local.properties"/>
    <property file="build.properties"/>
    <property file="default.properties"/>

    <target name="obfuscate" depends="angband-release">
	<proguard>
	    -libraryjars ${android.jar}: ${external-libs-folder}
	    -injars      ${out-classes-location}
	    -outjars     ${obfuscate-location}/classes.min.jar
	    -keep public class * extends android.app.Activity
	    -optimizations !code/simplification/cast
       </proguard>
    </target>
    
    <target name="angband-release" depends="plugin-resources, plugin-libs, release" />
    <target name="angband-debug"   depends="plugin-resources, plugin-libs, debug" />

<!--
    ************************************************************************
    *                                                                      *
    *  Plugins                                                             *
    *                                                                      *
    ************************************************************************
-->

    <target name="plugin-resources">
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-resources">
	    <property name="plugin.name" value="angband"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-resources">
	    <property name="plugin.name" value="angband306"/>
	</ant>
<!--
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-resources">
	    <property name="plugin.name" value="tome"/>
	</ant>
-->
    </target>

    <condition property="is.exist.jni.header">
        <available file="angdroid.h" type="file" filepath="plugin/include"/>
    </condition>

    <target name="angband-javah" depends="compile" unless="is.exist.jni.header">
        <javah outputFile="plugin/include/angdroid.h"
            classpath="${out-classes-location}"
            bootclasspath="${android-jar}"
            verbose="true">
            <class name="org.angdroid.angband.TermView" />
            <class name="org.angdroid.angband.AngbandActivity" />
        </javah>
    </target>

    <target name="plugin-libs" depends="angband-javah">
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-lib">
	    <property name="plugin.name" value="loader"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-lib">
	    <property name="plugin.name" value="angband"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-lib">
	    <property name="plugin.name" value="angband306"/>
	</ant>
<!--
	<ant inheritAll="true" antfile="plugin/build.xml" target="plugin-lib">
	    <property name="plugin.name" value="tome"/>
	</ant>
-->
    </target>

    <target name="plugin-src">
	<ant inheritAll="true" antfile="plugin/build.xml" target="get-patch-plugin-src">
	    <property name="plugin.name" value="angband306"/>
	    <property name="src.url.base" value="http://rephial.org/downloads/3.0"/>
	    <property name="src.url.file" value="angband-3.0.6-src.tar.gz"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="get-patch-plugin-src">
	    <property name="plugin.name" value="angband"/>
	    <property name="src.url.base" value="http://rephial.org/downloads/3.1"/>
	    <property name="src.url.file" value="angband-3.1.2v2-src.tar.gz"/>
	</ant>
    </target>


<!--
    ************************************************************************
    *                                                                      *
    *  Clean                                                               *
    *                                                                      *
    ************************************************************************
-->

    <target name="clean-plugins">
	<ant inheritAll="true" antfile="plugin/build.xml" target="clean">
	    <property name="plugin.name" value="loader"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="clean">
	    <property name="plugin.name" value="angband"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="clean">
	    <property name="plugin.name" value="angband306"/>
	</ant>
	<ant inheritAll="true" antfile="plugin/build.xml" target="clean">
	    <property name="plugin.name" value="tome"/>
	</ant>
    </target>

    <target name="clean" depends="clean-plugins">
        <delete dir="bin"/>
        <delete dir="gen"/>
        <delete dir="libs/armeabi"/>
	<delete file="plugin/include/angdroid.h"/>
    </target>


<!--
    ************************************************************************
    *                                                                      *
    *  Android SDK Setup                                                   *
    *                                                                      *
    ************************************************************************
-->

    <path id="android.antlibs">
        <pathelement path="${sdk-location}/tools/lib/anttasks.jar" />
        <pathelement path="${sdk-location}/tools/lib/sdklib.jar" />
        <pathelement path="${sdk-location}/tools/lib/androidprefs.jar" />
        <pathelement path="${sdk-location}/tools/lib/apkbuilder.jar" />
        <pathelement path="${sdk-location}/tools/lib/jarutils.jar" />
    </path>

    <taskdef name="setup"
        classname="com.android.ant.SetupTask"
        classpathref="android.antlibs"/>

    <setup/>

</project>
